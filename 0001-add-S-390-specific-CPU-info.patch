From 42c2acf867ae0fbfdd7f3e9c943b04715569c4a3 Mon Sep 17 00:00:00 2001
From: Lyonel Vincent <lyonel@ezix.org>
Date: Wed, 16 Jul 2014 22:19:16 +0000
Subject: [PATCH 1/1] add S/390-specific CPU info

git-svn-id: http://ezix.org/source/packages/lshw/development@2536 811e2811-9fd9-0310-a116-b6e8ac943c8b
---
 src/core/cpuinfo.cc | 45 +++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 45 insertions(+)

diff --git a/src/core/cpuinfo.cc b/src/core/cpuinfo.cc
index 85213f4..f16c2b5 100644
--- a/src/core/cpuinfo.cc
+++ b/src/core/cpuinfo.cc
@@ -77,6 +77,48 @@ string value)
 }
 #endif
 
+#ifdef __s390x__
+
+static void cpuinfo_s390(hwNode & node,
+string id,
+string value)
+{
+  if (id.substr(0, string("processor").size())=="processor")
+    currentcpu++;
+
+  hwNode *cpu = getcpu(node, currentcpu);
+
+  if (cpu)
+  {
+    cpu->addHint("logo", string("s390"));
+    cpu->claim(true);
+    if (id == "vendor_id")
+    {
+      if (value == "IBM/S390")
+        value = "IBM";
+      cpu->setVendor(value);
+    }
+
+    if (id == "features")
+      while (value.length() > 0)
+    {
+      size_t pos = value.find(' ');
+      string capability = (pos==string::npos)?value:value.substr(0, pos);
+
+      cpu->addCapability(capability);
+
+      if (pos == string::npos)
+        value = "";
+      else
+        value = hw::strip(value.substr(pos));
+    }
+
+    /* TODO: description for the capabilities*/
+  }
+}
+#endif
+
+
 #ifdef __ia64__
 static void cpuinfo_ia64(hwNode & node,
 string id,
@@ -424,6 +466,9 @@ bool scan_cpuinfo(hwNode & n)
 #ifdef __powerpc__
         cpuinfo_ppc(n, id, value);
 #endif
+#ifdef __s390x__
+        cpuinfo_s390(n, id, value);
+#endif
 #ifdef __hppa__
         cpuinfo_hppa(n, id, value);
 #endif
-- 
2.7.3

